enable
conf t

hostname NG-2

!! MPLS !!

mpls ldp advertise-labels
mpls ldp router-id Loopback 0 force

!! VRF Telredor !!

ip vrf vrf-telredor
	rd 65000:1
	route-target both 65000:1

!! INTERFACES !!

interface Loopback 0
	!Identifiant
	ip address 172.16.128.2 255.255.255.255

interface Serial 0/0
	!Vers NG-1
	encapsulation ppp
	ip address 172.16.0.2 255.255.255.252
	mpls ip
	no shutdown

interface Serial 0/1
	!Vers NG-3
	encapsulation ppp
	ip address 172.16.0.10 255.255.255.252
	mpls ip
	no shutdown

!! INTERFACES TELREDOR !!

interface Serial 0/2
	!Vers AC-Front
	encapsulation ppp
	ip vrf forwarding vrf-telredor
	ip address 10.7.254.1 255.255.255.252
	no shutdown

!! ROUTAGE INTERNE !!

router ospf 1
	network 172.16.0.0 0.0.255.255 area 0

!! ROUTAGE TELREDOR !!

router ospf 2 vrf vrf-telredor
	!Routage US
	network 10.4.0.0 0.3.255.255 area 2
	redistribute bgp 100 subnets

router bgp 100
	neighbor 172.16.128.1 remote-as 100
	neighbor 172.16.128.1 update-source Loopback 0
	neighbor 172.16.128.3 remote-as 100
	neighbor 172.16.128.3 update-source Loopback 0
	address-family vpnv4
		neighbor 172.16.128.1 activate
		neighbor 172.16.128.1 send-community both
		neighbor 172.16.128.3 activate
		neighbor 172.16.128.3 send-community both
	address-family ipv4 vrf vrf-telredor
		redistribute ospf 2 vrf vrf-telredor